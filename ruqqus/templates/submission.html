{% extends "default.html" %}

{% set ups=p.upvotes_fuzzed %}
{% set downs=p.downvotes_fuzzed %}
{% set score=ups-downs %}

{% block stylesheets %}
{% if v and v.can_use_darkmode and session.get("dark_mode_enabled") %}
<link id="css-link" rel="stylesheet" href="{{p.board.css_dark_url}}?v=2.35.62">
{% else %}
<link id="css-link" rel="stylesheet" href="{{p.board.css_url}}?v=2.35.62">
{% endif %}
{% endblock %}

{% block darkswitch %}

<script>
	function switch_css_board() {
		css = document.getElementById("css-link");
		dswitch = document.getElementById("dark-switch");

		if (css.href.endsWith("{{p.board.css_url}}")) {

			post("/settings/dark_mode/1",
				callback=function(){
					css.href="{{p.board.css_dark_url}}";
					dswitch.classList.remove("fa-toggle-off");
					dswitch.classList.add("fa-toggle-on");
				}
				);
		}
		else {
			post("/settings/dark_mode/0",
				callback=function(){
					css.href="{{p.board.css_url}}";
					dswitch.classList.remove("fa-toggle-on");
					dswitch.classList.add("fa-toggle-off");
				}
				);

		}
	}
</script>
{% if v and v.can_use_darkmode and session.get("dark_mode_enabled")%}
<a class="dropdown-item" href="javascript:void(0)" onclick="switch_css_board()"><i class="fad fa-toggle-on fa-fw text-left mr-3" id="dark-switch"></i>Light mode</a>
{% elif v and v.can_use_darkmode %}
<a class="dropdown-item" href="javascript:void(0)" onclick="switch_css_board()"><i class="fad fa-toggle-off fa-fw text-left mr-3" id="dark-switch"></i>Light mode</a>
{% else %}
<a class="dropdown-item" href="/settings/profile#referral"><i class="fad fa-toggle-off fa-fw text-left mr-3"></i>Light mode</a>
{% endif %}
{% endblock %}

{% block darkswitchMobile %}
{% if v and v.can_use_darkmode and session.get("dark_mode_enabled")%}
<li class="nav-item"><a class="nav-link" href="javascript:void(0)" onclick="switch_css_board()"><i class="fad fa-toggle-on fa-fw mr-3" id="dark-switch"></i>Light mode</a></li>
{% elif v and v.can_use_darkmode %}
<li class="nav-item"><a class="nav-link" href="javascript:void(0)" onclick="switch_css_board()"><i class="fad fa-toggle-off fa-fw mr-3" id="dark-switch"></i>Light mode</a></li>
{% else %}
<li class="nav-item"><a class="nav-link" href="/settings/profile#referral"><i class="fad fa-toggle-off fa-fw mr-3"></i>Light mode</a></li>
{% endif %}
{% endblock %}

{% block sidebarblock %}
<div class="sidebar-section sidebar-info">
	<div class="title"><i class="fas fa-info-circle mr-2"></i>Post Info</div>
	<div class="body">
		{% if p.board_id != p.original_board_id %}
		<div class="text-small mb-2">Originally posted in: <a href="{{p.original_board.permalink}}">+{{p.original_board.name}}</a></div>
		{% endif %}
		<div class="text-small mb-2">Shortlink: <input readonly="readonly" value="https://ruqq.us/{{p.base36id}}" data-clipboard-text="https://ruqq.us/{{p.base36id}}" role="button" class="copy-link form-control form-control-sm rounded"></div>
	</div>
</div>
{% endblock %}

{% if v %}
{% set voted=p.voted if p.voted else 0 %}
{% else %}
{% set voted=-2 %}
{% endif %}

{% block title %}

<meta charset="utf-8" />
<meta property="og:type" content="article" />

{% if comment_info and not comment_info.is_banned and not linked_comment.deleted_utc > 0 %}
<title>{{'@'+comment_info.author.username if not comment_info.author.is_deleted else '[deleted account]'}} comments on "{{p.title}} - Drama"</title>


<meta property="og:article:author" content="{{'@'+comment_info.author.username if not comment_info.author.is_deleted else '[deleted account]'}}" />
<meta property="article:section" content="+{{p.board.name}}" />
<meta property="article:published_time" content="{{comment_info.created_datetime}}" />
{% if comment_info.edited_utc %}<meta property="article:modified_time" content="{{comment_info.edited_string}}" />{% endif %}
<meta property="og:description" name="description" content="{{comment_info.body}}" />
<meta property="og:author" name="author" content="{{'@'+comment_info.author.username if not comment_info.author.is_deleted else '[deleted account]'}}" />
<meta property="og:title" content="{{'@'+comment_info.author.username if not comment_info.author.is_deleted else '[deleted account]'}} comments on {{p.title}} - Drama" />
<meta property="og:image" content="{% if p.is_image %}{{p.url}}{% elif p.has_thumb%}{{p.thumb_url}}{% else %}{{'/assets/images/preview.png' | full_link}}{% endif %}" />
<meta property="og:url" content="{{comment_info.permalink | full_link}}" />
<meta property="og:site_name" content="rdrama.net" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ruqqus">
<meta name="twitter:title" content="{{'@'+comment_info.author.username if not comment_info.author.is_deleted else '[deleted account]'}} comments on {{p.title}} - Drama" />
<meta name="twitter:creator" content="{{'@'+comment_info.author.username if not comment_info.author.is_deleted else '[deleted account]'}}">
<meta name="twitter:description" content="{{comment_info.body}}" />
<meta name="twitter:image" content="{% if p.is_image %}{{p.url}}{% elif p.has_thumb%}{{p.thumb_url}}{% else %}{{'/assets/images/preview.png' | full_link}}{% endif %}" />
<meta name="twitter:url" content="{{p.permalink | full_link}}" />

{% if linked_comment.author.is_private %}
<meta name="robots" content="noindex">
{% endif %}

{% else %}
<title>{{p.title | safe}} - Drama</title>


<meta property="og:article:author" content="{{'@'+p.author.username if not p.author.is_deleted else '[deleted account]'}}" />
<meta property="article:section" content="+{{p.board.name}}" />
<meta property="article:published_time" content="{{p.created_iso}}" />
{% if p.edited_utc %}<meta property="article:modified_time" content="{{p.edited_string}}" />{% endif %}
<meta property="og:description" name="description" content="{{p.body}}" />
<meta property="og:author" name="author" content="{{'@'+p.author.username if not p.author.is_deleted else '[deleted account]'}}" />
<meta property="og:title" content="{{p.title}} - Drama" />
<meta property="og:image" content="{% if p.is_image %}{{p.url}}{% elif p.has_thumb%}{{p.thumb_url}}{% else %}{{'/assets/images/preview.png' | full_link}}{% endif %}" />
<meta property="og:url" content="{{p.permalink | full_link}}" />
<meta property="og:site_name" content="rdrama.net" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:site" content="@ruqqus">
<meta name="twitter:title" content="{{p.title}} - Drama" />
<meta name="twitter:creator" content="{{'@'+p.author.username if not p.author.is_deleted else '[deleted account]'}}">
<meta name="twitter:description" content="{{p.body}}" />
<meta name="twitter:image" content="{% if p.is_image %}{{p.url}}{% elif p.has_thumb %}{{p.thumb_url}}{% else %}{{'/assets/images/preview.png' | full_link}}{% endif %}" />
<meta name="twitter:url" content="{{p.permalink | full_link}}" />

{% if p.author.is_private %}
<meta name="robots" content="noindex">
{% endif %}

{% endif %}
{% endblock %}

{% block pagetype %}thread{% endblock %}

{% block actionsModal %}
<!-- Post Actions Modal -->
<div class="modal fade modal-sm-bottom d-md-none" id="actionsModal" tabindex="-1" role="dialog" aria-labelledby="actionsModalTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header p-3">
				<h5 class="col modal-title text-center h6">More options</h5>
				<button type="button" class="close position-absolute py-3" style="right: 1rem;" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true"><i class="fas fa-times-circle text-gray-500"></i></span>
				</button>
			</div>
			<div class="modal-body">
				<ul class="list-group post-actions">
					{% if v and v.admin_level==0 and not v.id==p.author_id and not p.author.is_deleted %}
					<button class="btn btn-link btn-block btn-lg text-left text-muted" data-toggle="modal" data-dismiss="modal" data-target="#reportPostModal" onclick="report_postModal('{{p.base36id}}','{{'@'+p.author.username if not p.author.is_deleted else '[deleted account]'}}','{{p.board.name}}')" class="d-block"><i class="far fa-flag text-center text-muted mr-3"></i>Flag</button>
					{% endif %}
					{% if v and v.id==p.author_id %}
					{% if p.private %}
					<button class="btn btn-link btn-block btn-lg text-left text-muted"><a href="javascript:void(0)" onclick="post('/api/publish/{{p.base36id}}', function(){window.location.reload(true);})"><i class="fas fa-globe text-center text-muted mr-3"></i>Publish</a></button>
					{% endif %}

					<button class="btn btn-link btn-block btn-lg text-left text-muted" data-dismiss="modal" onclick="togglePostEdit('{{p.base36id}}')"><i class="far fa-edit text-center text-muted mr-3"></i>Edit</button>

					<button class="btn btn-link btn-block btn-lg text-left text-muted" data-toggle="modal" data-dismiss="modal" data-target="#deletePostModal" onclick="delete_postModal('{{p.base36id}}')"><i class="far fa-trash-alt text-center text-muted mr-3"></i>Delete</button>
					{% endif %}

					 <button class="btn btn-link btn-block btn-lg text-left text-muted"><a href="/admin/vote_info?link=https://rdrama.net{{p.permalink}}"><i class="fas fa-arrows-v text-center text-muted mr-3"></i>Votes</a></button>

					{% if v and (v.id==p.author_id or v.admin_level>=3 or p.is_guildmaster('content')) %}
					{% if not p.board.over_18 %}
					<button class="btn btn-link btn-block btn-lg text-left text-muted" onclick="post('/api/toggle_post_nsfw/{{p.base36id}}', function(){window.location.reload(true);})"><i class="far fa-eye-evil text-center text-muted mr-3"></i>Toggle NSFW</button>
					{% endif %}

					{% if not p.board.is_nsfl %}
					<button class="btn btn-link btn-block btn-lg text-left text-muted" onclick="post('/api/toggle_post_nsfl/{{p.base36id}}', function(){window.location.reload(true);})"><i class="far fa-skull text-center text-muted mr-3"></i>Toggle NSFL</button>
					{% endif %}

					{% endif %}
					{% if v %}
						{% if v.admin_level >=3 %}
							<button class="btn btn-link btn-block btn-lg text-info text-left" id="sticky-post-{{p.base36id}}" href="javascript:void(0)" onclick="post('/api/sticky/{{p.base36id}}',callback=function(){window.location.reload(true);})"><i class="fas fa-thumbtack text-center text-muted mr-3"></i>{% if p.stickied %}Unpin{% else %}Pin{% endif %}</button>
							{% if v==p.author %}
							<button class="btn btn-link btn-block btn-lg text-left text-warning" id="distinguish-post-{{p.base36id}}" href="javascript:void(0)" onclick="post('/api/distinguish/{{p.base36id}}',callback=function(){window.location.reload(true);})"><i class="fas fa-crown text-center text-muted mr-3"></i>Distinguish</button>
							{% endif %}

						
							{% if p.is_banned %}
							<button class="btn btn-link btn-block btn-lg text-success text-left" id="moderate-post-{{p.base36id}}" href="javascript:void(0)" onclick="approvePost('{{p.base36id}}')"><i class="far fa-check text-center text-success mr-3"></i>Approve</button>
							{% else %}
							<button class="btn btn-link btn-block btn-lg text-danger text-left" id="moderate-post-{{p.base36id}}" href="javascript:void(0)" onclick="removePost('{{p.base36id}}')"><i class="far fa-ban text-center text-danger mr-3"></i>Remove</button>
							{% endif %}
						{% endif %}

						{% if v.admin_level >=4 and p.oauth_app %}
							<button class="btn btn-link btn-block btn-lg text-muted text-left"	href="{{p.oauth_app.permalink}}"><a href="{{p.oauth_app.permalink}}"><i class="far fa-code text-center text-muted mr-3"></i>API App</a></button>
						{% endif %}

					{% endif %}

					{% if v and not v.id==p.author_id and	p.deleted_utc == 0 and not p.author.is_deleted %}
						<button id="block-user-button-{{p.base36id}}" class="btn btn-link btn-block btn-lg text-left text-danger{% if p.is_blocking %} d-none{% endif %}" data-dismiss="modal" onclick="post_toast('/settings/block?username={{p.author.username}}', callback=function(){document.getElementById('block-user-button-{{p.base36id}}').classList.toggle('d-none');document.getElementById('unblock-user-button-{{p.base36id}}').classList.toggle('d-none');})"
						><i class="fas fa-user-slash text-danger mr-3"></i>Block user</button>
						<button id="unblock-user-button-{{p.base36id}}" class="btn btn-link btn-block btn-lg text-left text-danger{% if not p.is_blocking %} d-none{% endif %}" data-dismiss="modal" onclick="post_toast('/settings/unblock?username={{p.author.username}}', callback=function(){document.getElementById('block-user-button-{{p.base36id}}').classList.toggle('d-none');document.getElementById('unblock-user-button-{{p.base36id}}').classList.toggle('d-none');})"
						><i class="fas fa-user-slash text-danger mr-3"></i>Unblock user</button>
					{% endif %}
					
					{% if v and v.admin_level == 6 and v.id!=p.author_id %}
					{% if p.author.is_banned %}
					<button class="btn btn-link btn-block btn-lg text-left text-danger" id="unexile-user-button-{{p.base36id}}" href="javascript:void(0)" onclick="post_toast('/api/unban_user/{{p.author_id}}?toast=1')"><i class="fas fa-user-minus mr-3 text-danger"></i>Unban user</a></button>
					{% else %}
					<button class="btn btn-link btn-block btn-lg text-left text-danger" id="exile-user-button-{{p.base36id}}" href="javascript:void(0)" onclick="post_toast('/api/ban_user/{{p.author_id}}?toast=1')"><i class="fas fa-user-minus mr-3 text-danger"></i>Ban user</a></button>
					{% endif %}
					{% endif %}

				</ul>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block content %}
<div class="row mb-3">

	<div class="col-12">

		<div id="post-{{p.base36id}}" class="card border-0 mt-3{% if p.is_banned %} banned{% endif %}{% if p.stickied %} stickied{% endif %}{% if voted==1 %} upvoted{% elif voted==-1 %} downvoted{% endif %}">
			<div class="d-flex flex-row-reverse flex-nowrap justify-content-end">

				{% if p.thumb_url and not p.embed_url %}
				<div class="card-header bg-transparent border-0 d-none d-md-flex flex-row flex-nowrap pl-3 p-0">
					<a href="{{p.url}}" style="height: fit-content;" target="_blank" rel="nofollow"{% if p.is_image %} data-toggle="modal" data-target="#expandImageModal" onclick="expandDesktopImage('{{p.url}}','{{p.url}}')"{% endif %}><img src="{{p.thumb_url}}" class="post-img d-none d-md-block" alt="Unable to load image"></a>

				</div>
				{% endif %}

				<div class="card-block w-100 my-md-auto">

					<div class="post-meta text-left d-none d-md-block mb-md-2">
						{% if p.stickied %}<i class="fas fa-thumbtack fa-fw text-admin fa-rotate--45" data-toggle="tooltip" data-placement="bottom" title="Pinned post"></i>&nbsp;{% endif %}
						{% if p.is_pinned %}<i class="fas fa-thumbtack fa-fw text-info fa-rotate--45" data-toggle="tooltip" data-placement="bottom" title="Pinned to +{{p.board.name}}"></i>&nbsp;{% endif %}
						{% if p.is_archived %}<i class="fas fa-archive text-warning" data-toggle="tooltip" data-placement="bottom" title="Archived post"></i>&nbsp;{% endif %}{% if p.author.is_deleted %}[deleted account]{% else %}<a href="{{p.author.permalink}}" style="color: #{{p.author.namecolor}}; font-weight: bold;" class="user-name">&nbsp;<img src="{{p.author.profile_url}}" class="profile-pic-20">&nbsp;&nbsp;{{p.author.username}}</a><span style="color: #{{p.author.titlecolor}}">{% if p.author.customtitle %}&nbsp;{{p.author.customtitle | safe}}{% endif %}</span>{% endif %}
						<span data-toggle="tooltip" data-placement="bottom"  title="{{p.created_datetime}}">&nbsp;{{p.age_string}}</span>
						{% if p.is_exiled_for %} <i class="fad fa-gavel text-danger" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="User was exiled from +{{p.original_board.name}} for this post."></i>{% endif %}
						{% if p.is_bot %} <i class="fad fa-robot text-info" data-toggle="tooltip" data-placement="bottom"	data-original-title="Bot"></i>
						{% endif %}
						{% if p.distinguish_level %} <i class="fad fa-shield text-admin" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Drama Badmin, speaking officially"></i>{% endif %}{% if p.gm_distinguish %} <i class="fad fa-crown {% if p.gm_distinguish==p.board_id %}text-warning{% else %}text-muted{% endif %}" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Guildmaster of +{{p.distinguished_board.name}}"></i>{% endif %}&nbsp;({% if p.url %}<a href="/search?q=domain%3A{{p.domain}}&sort=new&t=all" target="_blank">{{p.domain}}</a>{% else %}text post{% endif %})&nbsp;&nbsp;{% if not p.is_public %}<i class="fas fa-eye-slash text-warning" data-toggle="tooltip" data-placement="bottom" title="Private post, visible because {{p.visibility_reason(v)}}"></i>{% endif %}{% if p.edited_utc %}&nbsp;Edited <span data-toggle="tooltip" data-placement="bottom"  title="{{edited_datetime}}">{{p.edited_string}}</span>{% endif %}{% if p.over_18 %}<span class="badge badge-danger text-small-extra mr-1">nsfw</span>{% endif %} {% if p.is_nsfl %}<span class="badge text-black border-danger border-1 text-small-extra">nsfl</span>{% endif %}{% if p.private %}<span class="badge border-warning border-1 text-small-extra">unlisted</span>{% endif %}{% if p.is_repost %}<span class="badge border-warning border-1 text-small-extra"><a class="text-warning" href="{{p.reposts.permalink}}">repost</a></span>{% endif %}
					</div>

					{% if p.url %}
					<h1 id="post-title" class="card-title post-title text-left mb-md-3"><a target="_blank" href="{{p.url}}" rel="nofollow noopener">{{p.title | safe}}</a></h1>
					{% else %}
					<h1 id="post-title" class="card-title post-title text-left mb-md-3">{{p.title | safe}}</h1>
					{% endif %}

					<div class="post-meta text-left d-block d-md-none mb-3">
						{% if p.stickied %}<i class="fas fa-thumbtack fa-fw text-admin fa-rotate--45" data-toggle="tooltip" data-placement="bottom" title="Pinned post"></i>&nbsp;{% endif %}
						{% if p.is_pinned %}<i class="fas fa-thumbtack fa-fw text-info fa-rotate--45" data-toggle="tooltip" data-placement="bottom" title="Pinned to +{{p.board.name}}"></i>&nbsp;{% endif %}
						{% if p.is_archived %}<i class="fas fa-archive text-warning" data-toggle="tooltip" data-placement="bottom" title="Archived post"></i>&nbsp;{% endif %}	
						{% if p.over_18 %}<span class="badge badge-danger text-small-extra mr-1">nsfw</span>{% endif %}
						{% if p.is_nsfl %}<span class="badge text-black border-danger border-1 text-small-extra">nsfl</span>&nbsp;{% endif %}
						{% if p.private %}<span class="text-warning"><i class="far fa-eye-slash text-small mr-1"></i>unlisted</span>&nbsp;{% endif %}
						{% if p.is_repost %}<span class="text-warning"><i class="far fa-sync text-small mr-1"></i><a class="text-warning" href="{{p.reposts.permalink}}">repost</a></span>&nbsp;{% endif %}
						{% if p.author.is_deleted %}[deleted account]{% else %}<a href="{{p.author.permalink}}" style="color: #{{p.author.namecolor}}; font-weight: bold;" class="user-name">&nbsp;<img src="{{p.author.profile_url}}" class="profile-pic-20">&nbsp;&nbsp;{{p.author.username}}</a>	<span style="color: #{{p.author.titlecolor}}">{% if p.author.customtitle %}&nbsp;&nbsp;{{p.author.customtitle | safe}}{% endif %}</span>{% endif %}
						 <span data-toggle="tooltip" data-placement="bottom"  title="{{p.created_datetime}}">&nbsp;{{p.age_string}}&nbsp;</span>
						{% if p.is_exiled_for %}<i class="fad fa-gavel text-danger" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="User was exiled from +{{p.original_board.name}} for this post."></i>
						{% endif %}
						{% if p.is_bot %} <i class="fad fa-robot text-info" data-toggle="tooltip" data-placement="bottom"	data-original-title="Bot"></i>
						{% endif %}
						{% if p.distinguish_level %} <i class="fad fa-shield text-admin" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Drama Badmin, speaking officially"></i>{% endif %}
						{% if p.gm_distinguish %} <i class="fad fa-crown {% if p.gm_distinguish==p.board_id %}text-warning{% else %}text-muted{% endif %}" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Guildmaster of +{{p.distinguished_board.name}}"></i>{% endif %}
						{% if not p.is_public %}&nbsp;<i class="fas fa-eye-slash text-warning" data-toggle="tooltip" data-placement="bottom" title="Private post, visible because {{p.visibility_reason(v)}}"></i>{% endif %}
						{% if p.edited_utc %} · Edited <span data-toggle="tooltip" data-placement="bottom"  title="{{edited_datetime}}">{{p.edited_string}}</span>{% endif %}
					</div>

					<div id="post-body" class="post-body mt-3">

						{% if p.url and not p.embed_url and not p.is_image %}
						<a href="{{p.url}}" target="_blank">
							<div class="d-flex d-md-none justify-content-between align-items-center border rounded p-2{% if p.body_html %} mb-3{% endif %}">
								<span>{{p.domain|truncate(30, True)}}</span>
								<i class="fas fa-external-link-alt text-small"></i>
							</div>
						</a>
						{% endif %}

						{{p.body_html | safe}}

						{% if p.embed_url and p.domain_obj and p.domain_obj.embed_template %}
							{% if p.domain == "twitter.com" and session.get("dark_mode_enabled")	%}
								 {% include "site_embeds/twitterdark.html" %}
							{% else %}
									{% include p.embed_template %}
							{% endif %}
						{% endif %}

					</div>

					{% if v and v.id==p.author_id and not v.is_banned %}
					<div id="edit-post-body-{{p.base36id}}" class="d-none comment-write collapsed child">
						<form id="post-edit-form-{{p.base36id}}" class="d-flex flex-column" action="/edit_post/{{p.base36id}}" method="post" class="input-group">
							<input type="hidden" name="formkey" value="{{v.formkey}}">
							<input type="hidden" name="current_page" value="{{request.path}}">
                            <input name="title" required placeholder="title" value="{{ p.title }}" />
							<textarea name="body" id="post-edit-box-{{p.base36id}}" form="post-edit-form-{{p.base36id}}" class="comment-box form-control rounded" aria-label="With textarea" placeholder="Add text to your post..." rows="3">{{p.body}}</textarea> 
							<div class="comment-format"> 
								<small class="format pl-0"><i class="fas fa-bold" aria-hidden="true" onclick="makeBold('post-edit-box-{{p.base36id}}')" data-toggle="tooltip" data-placement="bottom" title="Bold"></i></small> 
								<small class="format"><i class="fas fa-italic" aria-hidden="true" onclick="makeItalics('post-edit-box-{{p.base36id}}')" data-toggle="tooltip" data-placement="bottom" title="Italicize"></i></small> 
								<small class="format"><i class="fas fa-quote-right" aria-hidden="true" onclick="makeQuote('post-edit-box-{{p.base36id}}')" data-toggle="tooltip" data-placement="bottom" title="Quote"></i></small>
								<small class="format"><span class="font-weight-bolder text-uppercase" onclick="getGif();commentForm('post-edit-box-{{p.base36id}}')" aria-hidden="true" data-toggle="modal" data-target="#gifModal" data-toggle="tooltip" data-placement="bottom"  title="Add GIF">GIF</span></small>
								<small class="format"><i class="fas fa-smile-beam" onclick="commentForm('post-edit-box-{{p.base36id}}');loadEmojis()" aria-hidden="true" data-toggle="modal" data-target="#emojiModal" data-toggle="tooltip" data-placement="bottom"  title="Add EMOJI"></i></small>
								<small class="format d-none"><i class="fas fa-link" aria-hidden="true"></i></small> 
								<a href="javascript:void(0)" onclick="togglePostEdit('{{p.base36id}}')" class="btn btn-link text-muted ml-auto cancel-form">Cancel</a> 
								<button form="post-edit-form-{{p.base36id}}" class="btn btn-primary ml-2">Save Edit</button> </div> </form>
							</div>
							{% endif %}

							<div class="d-none d-md-flex justify-content-between align-items-center mt-2">
								<div class="post-actions mt-2">
				<ul class="list-inline text-right d-flex">

						<li class="list-inline-item"><a href="{{p.permalink}}"><i class="fas fa-comment-dots"></i>{{p.comment_count}}</a></li>

						{% if v and v.id==p.author_id %}
						{% if p.private %}
						<li class="list-inline-item"><a href="javascript:void(0)" onclick="post('/api/publish/{{p.base36id}}', function(){window.location.reload(true);})"><i class="fas fa-globe"></i>Publish</a></li>
						{% endif %}
						<li class="list-inline-item"><a href="javascript:void(0)" onclick="togglePostEdit('{{p.base36id}}')"><i class="fas fa-edit"></i>Edit</a></li>
						{% endif %}

						<li class="list-inline-item"><a href="/admin/vote_info?link=https://rdrama.net{{p.permalink}}"><i class="fas fa-arrows-v"></i>Votes</a></li>

						<li class="list-inline-item"><a href="javascript:void(0);" role="button" class="copy-link" data-clipboard-text="{{p.permalink | full_link}}"><i class="fas fa-copy"></i>Copy link</a></li>

						{% if v and v.admin_level==0 and not v.id==p.author_id %}
						<li class="list-inline-item"><a href="javascript:void(0)" data-toggle="modal" data-dismiss="modal" data-target="#reportPostModal" onclick="report_postModal('{{p.base36id}}', '{{p.author.username}}','{{p.board.name}}')"><i class="fas fa-flag"></i>Flag</a></li>
						{% endif %}

						{% if v and v.id==p.author_id %}
						<li class="list-inline-item"><a href="javascript:void(0)" data-toggle="modal" data-dismiss="modal" data-target="#deletePostModal" onclick="delete_postModal('{{p.base36id}}')"><i class="fas fa-trash-alt"></i>Delete</a></li>
						{% endif %}

						{% if v and (v.id==p.author_id or v.admin_level>=3 or p.is_guildmaster('content')) %}

						{% if not p.board.over_18 %}
						<li class="list-inline-item"><a href="javascript:void(0)" onclick="post('/api/toggle_post_nsfw/{{p.base36id}}', function(){window.location.reload(true);})"><i class="fas fa-eye-evil"></i>Toggle NSFW</a></li>
						{% endif %}

						{% if not p.board.is_nsfl %}
						<li class="list-inline-item"><a href="javascript:void(0)" onclick="post('/api/toggle_post_nsfl/{{p.base36id}}', function(){window.location.reload(true);})"><i class="fas fa-skull"></i>Toggle NSFL</a></li>
						{% endif %}

						{% endif %}
						
						{% if v and v.admin_level>=3 %}
						<li class="list-inline-item"><a href="javascript:void(0)" onclick="post('/api/sticky/{{p.base36id}}', function(){window.location.reload(true);})"><i class="fas fa-thumbtack"></i>{% if p.stickied %}Unpin{% else %}Pin{% endif %}</a></li>
						{% if v==p.author %}
						<li class="list-inline-item"><a href="javascript:void(0)" onclick="post('/api/distinguish/{{p.base36id}}', function(){window.location.reload(true);})"><i class="fas fa-crown"></i>Distinguish</a></li>
						{% endif %}
						{% endif %}

						{% if v %}

						{% if v.admin_level >=3 %}
						{% if p.is_banned or p.active_flags %}
						<li class="list-inline-item"><a class="text-success" id="moderate-post-{{p.base36id}}" href="javascript:void(0)" onclick="approvePost('{{p.base36id}}')"><i class="fas fa-check text-success"></i>Approve</a></li>
						{% endif %}
						{% if not p.is_banned or p.active_flags %}
						<li class="list-inline-item"><a id="moderate-post-{{p.base36id}}" href="javascript:void(0)" onclick="removePost('{{p.base36id}}')"><i class="fas fa-ban"></i>Remove</a></li>
						{% endif %}
						{% endif %}

						{% if v.admin_level >= 4 and p.oauth_app %}
						<li class="list-inline-item"><a href="{{p.oauth_app.permalink}}" ><i class="fas fa-code"></i>API App</a></li>
						{% endif %}

						{% if not v.id==p.author_id and not p.is_blocking%}
						<li class="list-inline-item"><a id="block-user-{{p.base36id}}" href="javascript:void(0)" onclick="post_toast('/settings/block?username={{p.author.username}}', callback=function(){document.getElementById('block-user-{{p.base36id}}').classList.toggle('d-none');document.getElementById('unblock-user-{{p.base36id}}').classList.toggle('d-none');})"><i class="fas fa-user-slash text-danger"></i>Block user</a></li>
						{% endif %}
						
						{% if not v.id==p.author_id and p.is_blocking%}
						<li class="list-inline-item"><a id="unblock-user-{{p.base36id}}" href="javascript:void(0)" onclick="post_toast('/settings/unblock?username={{p.author.username}}', callback=function(){document.getElementById('block-user-{{p.base36id}}').classList.toggle('d-none');document.getElementById('unblock-user-{{p.base36id}}').classList.toggle('d-none');})"><i class="fas fa-user-slash text-danger"></i>Unblock user</a></li>
						{% endif %}

						{% if v.admin_level >=3 and v.id!=p.author_id %}
						{% if p.author.is_banned %}
						<li class="list-inline-item"><a id="unexile2-user-{{p.base36id}}" href="javascript:void(0)" onclick="post('/api/unban_user/{{p.author_id}}', function(){window.location.reload(true);})"
						><i class="fas fa-user-slash text-danger"></i>Unban user</a></li>
						{% else %}
						<li class="list-inline-item"><a id="exile2-user-{{p.base36id}}" href="javascript:void(0)" onclick="post('/api/ban_user/{{p.author_id}}', function(){window.location.reload(true);})"
						><i class="fas fa-user-slash text-danger"></i>Ban user</a></li>
						{% endif %}
						{% endif %}
						{% endif %}
												
			</ul>
							</div>

						</div>

					</div>
					<!-- Voting on "medium" devices or larger, hidden on smaller devices -->

					{% if v %}

					<div id="voting" class="voting d-none d-md-block mb-auto">
						<div id="post-{{p.base36id}}-up" tabindex="0" data-id-up="{{p.base36id}}" data-content-type="post" class="mx-auto arrow-up upvote-button post-{{p.base36id}}-up {% if voted==1 %}active{% endif %}"></div>

						<span id="post-score-{{p.base36id}}" class="score post-score-{{p.base36id}} {% if voted==1 %}score-up{% elif voted==-1%}score-down{% endif %}" data-toggle="tooltip" data-placement="right" data-original-title="+{{ups}} | -{{downs}}">{% if p.is_banned %}✖{% else %}{{score}}{% endif %}</span>

						<div id="post-{{p.base36id}}-down" tabindex="0" data-id-down="{{p.base36id}}" data-content-type="post" class="text-muted mx-auto arrow-down downvote-button post-{{p.base36id}}-down {% if voted==-1 %}active{% endif %}"></div>
					</div>

					{% else %}

					<div id="voting" class="voting d-none d-md-block mb-auto">
						<div id="post-{{p.base36id}}-up" tabindex="0" class="arrow-up mx-auto" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						</div>
						<span id="post-{{p.base36id}}-score-none" class="score text-muted"{% if not p.is_banned %} data-toggle="tooltip" data-placement="right" data-original-title="+{{ups}} | -{{downs}}"{% endif %}>{% if p.is_banned %}✖{% else %}{{score}}{% endif %}</span>
						<div id="post-{{p.base36id}}-down" tabindex="0" class="arrow-down mx-auto" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						</div>
					</div>

					{% endif %}

				</div>




			</div>

		</div>

		<div class="row no-gutters d-block d-md-none">
			<div class="col">
			 <a target="_blank" rel="noopener noreferrer" href="{{p.url}}">{% if p.is_image %}<img src="{{p.url}}" class="img-fluid" alt="Unable to anonymously load image">
				 <div class="post-img-overlay d-block d-md-none">{{p.domain}}<i class="fas fa-external-link-alt text-small ml-2"></i></div>
				 {% endif %}
			 </a>
		 </div>
	 </div>

 </div>

 <div class="row mb-3 d-block d-md-none">
	<div class="col-12">

		<div class="post-actions">
			<ul class="list-inline text-right d-flex">

				<li class="list-inline-item mr-auto"><a href="{{p.permalink}}"><i class="fas fa-comment-dots"></i>{{p.comment_count}}</a></li>

				<li class="list-inline-item"><a href="javascript:void(0);" role="button" class="copy-link" data-clipboard-text="{{p.permalink | full_link}}"><i class="fas fa-link"></i>Share</a></li>
				{% if v %}
				<li class="list-inline-item">
					<a href="#" data-toggle="modal" data-target="#actionsModal">
						<i class="fas fa-ellipsis-h"></i>
					</a>
				</li>
				{% endif %}
				<li id="voting-{{p.base36id}}-mobile" class="voting list-inline-item d-md-none{% if voted==1 %} upvoted{% elif voted==-1 %} downvoted{% endif %}">
					{% if v %}
					<span id="post-{{p.base36id}}-up-mobile" tabindex="0" data-id-up="{{p.base36id}}" data-content-type="post" class="mr-2 arrow-up upvote-button post-{{p.base36id}}-up {% if voted==1 %}active{% endif %}">
					</span>
					{% else %}
					<span id="arrow-{{p.base36id}}-mobile-up" tabindex="0" class="mr-2 arrow-mobile-up" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						<i class="fas fa-arrow-alt-up mx-0" aria-hidden="true"></i>
					</span>
					{% endif %}

					<span id="post-score-{{p.base36id}}" class="score post-score-{{p.base36id}} {% if voted==1 %}score-up{% elif voted==-1%}score-down{% endif %}" data-toggle="tooltip" data-placement="top" data-original-title="+{{ups}} | -{{downs}}">{% if p.is_banned %}✖{% else %}{{score}}{% endif %}</span>

					{% if v %}
					<span id="post-{{p.base36id}}-down-mobile" tabindex="0" data-id-down="{{p.base36id}}" data-content-type="post" class="ml-2 my-0 arrow-down downvote-button post-{{p.base36id}}-down {% if voted==-1 %}active{% endif %}">
					</span>
					{% else %}
					<span id="arrow-{{p.base36id}}-mobile-down" tabindex="0" class="arrow-mobile-down ml-2 my-0" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						<i class="fas fa-arrow-alt-down mx-0" aria-hidden="true"></i>
					</span>
					{% endif %}
				</li>
			</ul>
		</div>

	</div>

</div>
<div class="row border-md-0 comment-section pb-3">
	<div class="col border-top">
		<div class="comments-count py-3">
			{% if linked_comment and p.comment_count >= 2%}
			<div class="total"><a href="{{p.permalink}}">View entire discussion</a></div>
			{% else %}
			<div class="total">Comments <span class="d-none d-md-inline-block">({{p.comment_count}})</span></div>
			{% endif %}
			<div class="post-filter ml-auto"><span>Sort By:</span>
				<span class="dropdown">
					<a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
					data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

				</a>
				<span class="dropdown-menu border-0 shadow dropdown-menu-right mt-2" aria-labelledby="dropdownMenuLink">
					<a class="dropdown-item" href="?sort=new">New</a>
					<a class="dropdown-item" href="?sort=top">Top</a>
					<a class="dropdown-item" href="?sort=controversial">Controversial</a>
					<a class="dropdown-item d-none" href="#">Based</a>
				</span>
			</span>
		</div>
	</div>

	{% if not p.is_banned and is_allowed_to_comment %}
	<div id="comment-form-space-{{p.fullname}}" class="comment-write mb-3">
		<form id="reply-to-{{p.fullname}}" class="input-group" action="/api/comment" method="post">
			<input type="hidden" name="formkey" value="{{v.formkey}}">
			<input type="hidden" name="parent_fullname" value="t2_{{p.base36id}}">
			<input id="reply-form-submission-{{p.fullname}}" type="hidden" name="submission" value="{{p.base36id}}">
			{% if v %}
			<textarea id="reply-form-body-{{p.fullname}}" class="comment-box form-control rounded" id="comment-form" name="body" form="reply-to-{{p.fullname}}" aria-label="With textarea" placeholder="Add your comment..." rows="1"></textarea>
			{% endif %}
			<div class="comment-format">
				<small class="format pl-0"><i class="fas fa-bold" onclick="makeBold('reply-form-body-{{p.fullname}}')" data-toggle="tooltip" data-placement="bottom"  title="Bold"></i></small>
				<small class="format"><i class="fas fa-italic" onclick="makeItalics('reply-form-body-{{p.fullname}}')" data-toggle="tooltip" data-placement="bottom"  title="Italicize"></i></small>
				<small class="format"><i class="fas fa-quote-right" onclick="makeQuote('reply-form-body-{{p.fullname}}')" data-toggle="tooltip" data-placement="bottom"  title="Quote"></i></small>
				<label class="btn btn-secondary format d-inline-block m-0" for="gif-reply-btn-{{p.fullname}}">
					<span id="gif-reply-btn-{{p.fullname}}" class="font-weight-bolder text-uppercase" onclick="getGif();commentForm('reply-form-body-{{p.fullname}}')" aria-hidden="true" data-toggle="modal" data-target="#gifModal" data-toggle="tooltip" data-placement="bottom" title="Add GIF">GIF</span>
				</label> 
				<p>&nbsp;</p>
				<label class="btn btn-secondary format d-inline-block m-0" for="emoji-reply-btn-{{p.fullname}}">
					<div id="emoji-reply-btn-{{p.fullname}}" onclick="commentForm('reply-form-body-{{p.fullname}}');loadEmojis()" aria-hidden="true" data-toggle="modal" data-target="#emojiModal" data-toggle="tooltip" data-placement="bottom" title="Add EMOJI"><i class="fas fa-smile-beam"></i></div>
				</label> 
				<label class="format btn btn-secondary m-0 ml-1 {% if v.true_score >= 0 %}d-inline-block{% else %}d-none{% endif %}" for="file-upload-reply-{{p.fullname}}">
					<div id="filename-show-reply-{{p.base36id}}"><i class="far fa-image"></i></div>
					<input id="file-upload-reply-{{p.fullname}}" type="file" name="file" accept="image/*" onchange="document.getElementById('filename-show-reply-{{p.base36id}}').innerHTML=document.getElementById('file-upload-reply-{{p.fullname}}').files[0].name;" hidden>
				</label>
				<p>&nbsp;&nbsp;</p>
				<div class="custom-control custom-checkbox">
					<input type="checkbox" class="custom-control-input" id="nsfwCheck-{{p.fullname}}" name="over_18" form="reply-to-{{p.fullname}}">
					<label class="custom-control-label" for="nsfwCheck">NSFW</label>
				</div>
				<p>&nbsp;&nbsp;</p>
				<div class="custom-control custom-checkbox">
					<input type="checkbox" class="custom-control-input" id="nsflCheck-{{p.fullname}}" name="is_nsfl" form="reply-to-{{p.fullname}}">
					<label class="custom-control-label" for="nsflCheck">NSFL</label>
				</div>
				<a id="save-reply-to-{{p.fullname}}" href="javascript:void(0)" form="reply-to-{{p.fullname}}" class="btn btn-primary text-whitebtn ml-auto" onclick="post_comment('{{p.fullname}}')">Comment</a>
			</div>
		</form>
	</div>
	{% endif %}

	{% if not v and not p.is_banned %}
	<div class="comment-write mb-3">
		<textarea class="comment-box form-control rounded" name="body" aria-label="With textarea" placeholder="Add your comment..." rows="1" onclick="location.href='/login?redirect={{request.path | urlencode}}';"></textarea>
	</div>
	{% if p.comment_count >= 2 %}
	<div class="card border-0 bg-light mt-4">
		<div class="card-body">
			<h5 class="card-title">Jump in the discussion.</h5>
			<p class="card-text">Become a dramatard, no email address required.</p>
			<div>
				<a href="/signup?redirect={{request.path | urlencode}}" class="btn btn-primary">Sign up</a>
				<a href="/login?redirect={{request.path | urlencode}}" class="btn btn-link text-muted">Sign in</a>
			</div>
		</div>
	</div>
	{% endif %}
	{% endif %}

	{% if p.replies %}
	<div class="comment-section">
	 {% with comments=p.replies %}
	 {% include "comments.html" %}
	 {% endwith %}
 </div>
 {% elif not p.replies and p.deleted_utc == 0 %}
 <div class="comment-section text-center py-7">
	<span class="fa-stack fa-2x text-muted mb-4">
		<i class="fas fa-square text-gray-500 opacity-25 fa-stack-2x"></i>
		<i class="fas text-gray-500 fa-ghost fa-stack-1x text-lg"></i>
	</span>
	<h2 class="h5">Be the first to comment!</h2>
	{% if v %}
	<p class="text-muted">This comment section is a ghost town...</p>
	{% else %}
	<p class="text-muted">This comment section is a ghost town. <a href="/login?redirect={{request.path | urlencode}}">Sign in</a></p>
	{% endif %}
</div>
{% endif %}

</div>

</div>

{% if v and v.id==p.author_id %}
{% include "delete_post_modal.html" %}
{% endif %}

{% include "delete_comment_modal.html" %}


{% endblock %}

{% block guildModal %}
{% include "guild_details_modal.html" %}
{% endblock %}

{% block GIFtoast %}
<div class="toast" id="toast-error-gif" style="position: fixed; bottom: 1.5rem; margin: 0 auto; left: 0; right: 0; width: 275px; z-index: 1000" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="true" data-delay="5000">
	<div class="toast-body bg-danger text-center text-white">
		<i class="fas fa-exclamation-circle mr-2"></i>Unable to snag gifs :(
	</div>
</div>
{% endblock %}

{% block GIFpicker %}
{% if v %}
{% include "gif_modal.html" %}
{% include "emoji_modal.html" %}
{% endif %}
{% endblock %}